<!DOCTYPE html>
<html lang="en"> 
<head>
  <meta charset="UTF-8"> 
  <title>Nigeria Accounting & Tax Software with VAT & Login (2026)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-bottom: 10px; }
    .section { margin-bottom: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { padding: 5px; margin-right: 4px; }
    .ledger-table { border-collapse: collapse; width: 100%; margin-bottom: 10px; }
    .ledger-table th, .ledger-table td { border: 1px solid #bbb; padding: 6px; text-align: left; }
    .ledger-table th { background: #f8f8f8; }
    .totals, .tax-summary, .vat-summary { background: #f0f0f0; padding: 10px; margin-bottom: 10px; }
    .remove-btn { color: #b00; cursor: pointer; border: none; background: none; font-size: 1em; }
    .edit-btn { color: #0077cc; cursor: pointer; border: none; background: none; font-size: 1em; }
    .form-inline input, .form-inline select { margin-bottom: 6px; }
    .form-inline { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-bottom: 10px; }
    #editModal { display:none; position:fixed; top:20%; left:50%; transform:translate(-50%,0); background:white; border:1px solid #888; padding:20px; z-index:10; }
    #editModal label { margin-top:0; }
    #editModal input, #editModal select { margin-bottom:10px; }
    #modalOverlay { display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.2); z-index:9; }
    #loginBox { max-width: 400px; background: #fafafa; border: 1px solid #ccc; padding: 25px; margin: 60px auto; border-radius: 8px; }
    #logoutBtn { margin-bottom: 15px; }
    #welcomeMsg { font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div id="loginBox"> 
    <h2>Login</h2>
    <form id="loginForm" onsubmit="return loginUser()"> 
      <label>Username:<br><input type="text" id="loginUser" required></label>
      <label>Password:<br><input type="password" id="loginPass" required></label>
      <button type="submit">Login</button>
    </form>
    <div id="loginError" style="color:red; margin-top:10px;"></div>
  </div>

  <div id="appContent" style="display:none;"> 
    <button id="logoutBtn" onclick="logoutUser()">Logout</button>
    <div id="welcomeMsg"></div>
    <h2>Nigeria Simple Accounting & Tax Software with VAT (2026)</h2>
    <div class="section"> 
      <div class="form-inline"> 
        <label>Date: <input type="date" id="txnDate" /></label>
        <label>Type:
          <select id="txnType"> 
            <option value="Income">Income (Sales)</option>
            <option value="Expense">Expense (Purchase)</option>
            <option value="Deduction">Deduction</option>
          </select>
        </label>
        <label>Category:
          <select id="txnCategory"> 
            <option>Pension</option>
            <option>NHF</option>
            <option>Insurance</option>
            <option>Salary</option>
            <option>Bonus</option>
            <option>Freelance</option>
            <option>Food</option>
            <option>Transport</option>
            <option>Rent</option>
            <option>Utilities</option>
            <option>Other</option>
          </select>
        </label>
        <label>Description: <input type="text" id="txnDesc" placeholder="Details" /></label>
        <label>Amount (₦): <input type="number" id="txnAmount" min="0" step="0.01" /></label>
        <button onclick="addTransaction()">Add Transaction</button>
      </div>
    </div>

    <div class="section"> 
      <h3>Transactions Ledger</h3>
      <table class="ledger-table" id="ledgerTable"> 
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Category</th>
            <th>Description</th>
            <th>Amount (₦)</th>
            <th>VAT (₦)</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="vat-summary" id="vatSummary"></div>
    <div class="totals" id="totalsSummary"></div>
    <div class="tax-summary" id="taxSummary"></div>

    <!-- Edit Modal -->
    <div id="modalOverlay"></div>
    <div id="editModal"> 
      <h3>Edit Transaction</h3>
      <label>Date: <input type="date" id="editTxnDate" /></label><br>
      <label>Type:
        <select id="editTxnType"> 
          <option value="Income">Income (Sales)</option>
          <option value="Expense">Expense (Purchase)</option>
          <option value="Deduction">Deduction</option>
        </select>
      </label><br>
      <label>Category:
        <select id="editTxnCategory"> 
          <option>Pension</option>
          <option>NHF</option>
          <option>Insurance</option>
          <option>Salary</option>
          <option>Bonus</option>
          <option>Freelance</option>
          <option>Food</option>
          <option>Transport</option>
          <option>Rent</option>
          <option>Utilities</option>
          <option>Other</option>
        </select>
      </label><br>
      <label>Description: <input type="text" id="editTxnDesc" /></label><br>
      <label>Amount (₦): <input type="number" id="editTxnAmount" min="0" step="0.01" /></label><br>
      <button onclick="saveEdit()">Save</button>
      <button onclick="closeEditModal()">Cancel</button>
    </div>
  </div>

  <script>
    // --- User Authentication Data ---
    // Set admin and users here!
    const adminAccount = { username: "administrator", password: "emma" };
    // You can add/remove users below
    const userAccounts = [
      { username: "user1", password: "user1pass" },
      { username: "user2", password: "user2pass" },
      { username: "user3", password: "user3pass" }
    ];

    let currentUser = null;
    let transactions = [];
    let editIndex = null;
    const VAT_RATE = 0.075;

    // --- Login / Logout ---
    function loginUser() {
      const uname = document.getElementById('loginUser').value.trim();
      const upass = document.getElementById('loginPass').value;
      let found = false, isAdmin = false;

      if (uname === adminAccount.username && upass === adminAccount.password) {
        isAdmin = true;
        found = true;
      } else {
        found = userAccounts.some(u => u.username === uname && u.password === upass);
      }

      if (found) {
        currentUser = { username: uname, isAdmin: isAdmin };
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('appContent').style.display = 'block';
        document.getElementById('welcomeMsg').innerText =
          `Welcome, ${isAdmin ? "Administrator" : "User"} (${uname})`;
        renderLedger(); calculateSummary();
      } else {
        document.getElementById('loginError').innerText = "Invalid username or password!";
      }
      return false; // prevent form submit
    }

    function logoutUser() {
      currentUser = null;
      document.getElementById('loginUser').value = "";
      document.getElementById('loginPass').value = "";
      document.getElementById('loginBox').style.display = 'block';
      document.getElementById('appContent').style.display = 'none';
      document.getElementById('loginError').innerText = "";
      transactions = [];
      renderLedger(); calculateSummary();
    }

    // --- App Logic (same as previous, with VAT and modal) ---
    function addTransaction() {
      const date = document.getElementById('txnDate').value;
      const type = document.getElementById('txnType').value;
      const category = document.getElementById('txnCategory').value;
      const desc = document.getElementById('txnDesc').value.trim();
      const amount = parseFloat(document.getElementById('txnAmount').value) || 0;

      if (!date || !desc || amount <= 0) {
        alert("Please fill all fields and enter a valid amount.");
        return;
      }

      transactions.push({ date, type, category, desc, amount });
      renderLedger();
      clearForm();
      calculateSummary();
    }

    function clearForm() {
      document.getElementById('txnDate').value = "";
      document.getElementById('txnDesc').value = "";
      document.getElementById('txnAmount').value = "";
      document.getElementById('txnType').value = "Income";
      document.getElementById('txnCategory').value = "Salary";
    }

    function renderLedger() {
      const tbody = document.getElementById('ledgerTable').getElementsByTagName('tbody')[0];
      tbody.innerHTML = "";
      transactions.forEach((txn, idx) => {
        let vat = 0;
        if (txn.type === "Income") vat = txn.amount * VAT_RATE;
        else if (txn.type === "Expense") vat = txn.amount * VAT_RATE;
        const tr = document.createElement('tr');
        tr.innerHTML =
          `<td>${txn.date}</td>
           <td>${txn.type}</td>
           <td>${txn.category}</td>
           <td>${txn.desc}</td>
           <td>₦${txn.amount.toLocaleString(undefined, {maximumFractionDigits:2})}</td>
           <td>₦${vat ? vat.toLocaleString(undefined, {maximumFractionDigits:2}) : ""}</td>
           <td>
             <button class=\"edit-btn\" onclick=\"openEditModal(${idx})\">Edit</button>
             <button class=\"remove-btn\" onclick=\"removeTransaction(${idx})\">Delete</button>
           </td>`;
        tbody.appendChild(tr);
      });
    }

    function removeTransaction(idx) {
      if (confirm("Delete this transaction?")) {
        transactions.splice(idx, 1);
        renderLedger();
        calculateSummary();
      }
    }

    function openEditModal(idx) {
      editIndex = idx;
      const t = transactions[idx];
      document.getElementById('editTxnDate').value = t.date;
      document.getElementById('editTxnType').value = t.type;
      document.getElementById('editTxnCategory').value = t.category;
      document.getElementById('editTxnDesc').value = t.desc;
      document.getElementById('editTxnAmount').value = t.amount;
      document.getElementById('editModal').style.display = "block";
      document.getElementById('modalOverlay').style.display = "block";
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = "none";
      document.getElementById('modalOverlay').style.display = "none";
    }

    function saveEdit() {
      const date = document.getElementById('editTxnDate').value;
      const type = document.getElementById('editTxnType').value;
      const category = document.getElementById('editTxnCategory').value;
      const desc = document.getElementById('editTxnDesc').value.trim();
      const amount = parseFloat(document.getElementById('editTxnAmount').value) || 0;
      if (!date || !desc || amount <= 0) {
        alert("Please fill all fields and enter a valid amount.");
        return;
      }
      transactions[editIndex] = { date, type, category, desc, amount };
      closeEditModal();
      renderLedger();
      calculateSummary();
    }

    function calculateSummary() {
      // Totals
      let incomeTotal = 0, expenseTotal = 0, deductionTotal = 0, rentTotal = 0;
      let vatOutputTotal = 0, vatInputTotal = 0;
      transactions.forEach(txn => {
        if (txn.type === "Income") {
          incomeTotal += txn.amount;
          vatOutputTotal += txn.amount * VAT_RATE;
        }
        else if (txn.type === "Expense") {
          expenseTotal += txn.amount;
          vatInputTotal += txn.amount * VAT_RATE;
          if (txn.category === "Rent") rentTotal += txn.amount;
        }
        else if (txn.type === "Deduction") deductionTotal += txn.amount;
      });

      let netBalance = incomeTotal - expenseTotal;
      let vatPayable = vatOutputTotal - vatInputTotal;
      let rentRelief = rentTotal * 0.20;
      if (rentRelief > 500000) rentRelief = 500000;

      // Taxable income
      let adjIncome = incomeTotal - deductionTotal - rentRelief;
      if (adjIncome < 0) adjIncome = 0;

      // Tax calculation (Nigeria PIT 2026)
      let tax = 0;
      if (adjIncome > 800000) {
        let taxable = adjIncome;
        function taxSlice(amount, rate) { return amount * rate; }
        let remaining = taxable - 800000;
        if (remaining > 0) {
          let slice = Math.min(remaining, 3000000 - 800000);
          tax += taxSlice(slice, 0.15); remaining -= slice;
        }
        if (remaining > 0) {
          let slice = Math.min(remaining, 12000000 - 3000000);
          tax += taxSlice(slice, 0.18); remaining -= slice;
        }
        if (remaining > 0) {
          let slice = Math.min(remaining, 25000000 - 12000000);
          tax += taxSlice(slice, 0.21); remaining -= slice;
        }
        if (remaining > 0) {
          let slice = Math.min(remaining, 50000000 - 25000000);
          tax += taxSlice(slice, 0.23); remaining -= slice;
        }
        if (remaining > 0) {
          tax += taxSlice(remaining, 0.25);
        }
      }

      let effRate = incomeTotal > 0 ? (tax / incomeTotal) * 100 : 0;

      document.getElementById('vatSummary').innerHTML =
        `<strong>VAT Summary (7.5%):</strong><br>
         VAT Output (Sales): ₦${vatOutputTotal.toLocaleString(undefined, {maximumFractionDigits:2})}<br>
         VAT Input (Purchases): ₦${vatInputTotal.toLocaleString(undefined, {maximumFractionDigits:2})}<br>
         <strong>VAT Payable:</strong> ₦${vatPayable.toLocaleString(undefined, {maximumFractionDigits:2})}`;

      document.getElementById('totalsSummary').innerHTML =
        `<strong>Income:</strong> ₦${incomeTotal.toLocaleString(undefined, {maximumFractionDigits:2})} | 
         <strong>Expenses:</strong> ₦${expenseTotal.toLocaleString(undefined, {maximumFractionDigits:2})} | 
         <strong>Deductions:</strong> ₦${deductionTotal.toLocaleString(undefined, {maximumFractionDigits:2})} | 
         <strong>Net Balance:</strong> ₦${netBalance.toLocaleString(undefined, {maximumFractionDigits:2})}`;

      document.getElementById('taxSummary').innerHTML =
        `<strong>Tax Calculation (PIT 2026):</strong><br>
         Rent relief applied: ₦${rentRelief.toLocaleString()}<br>
         Taxable income after deductions: ₦${adjIncome.toLocaleString()}<br>
         <strong>Tax payable:</strong> ₦${tax.toLocaleString(undefined, {maximumFractionDigits:0})}<br>
         Effective tax rate on gross income: ${effRate.toFixed(2)}%<br>
         ${adjIncome <= 800000 ? "<strong>No tax payable (taxable income ≤ ₦800,000)</strong>" : ""}
        `;
    }

    // Initial render
    // Don't show main app till login
    document.getElementById('appContent').style.display = 'none';
    document.getElementById('loginBox').style.display = 'block';
  </script>
</body>
</html>