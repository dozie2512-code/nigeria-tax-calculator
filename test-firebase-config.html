<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Configuration Test - Nigeria Tax Calculator</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #0b76d1; }
    .test-section {
      background: #f8f9fb;
      border: 1px solid #e1e4e8;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .status {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-weight: bold;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    button {
      background: #0b76d1;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #0a68be;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .code { font-family: monospace; background: #f3f5f7; padding: 2px 6px; border-radius: 3px; }
    input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
      max-width: 400px;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>üî• Firebase Configuration Test</h1>
  <p>This page helps you verify that Firebase is correctly configured for the Nigeria Tax Calculator application.</p>

  <div class="test-section">
    <h2>Step 1: Configuration Check</h2>
    <p>Checking if Firebase configuration is properly loaded...</p>
    <div id="configStatus"></div>
    <div id="configDetails"></div>
  </div>

  <div class="test-section">
    <h2>Step 2: Firebase Initialization</h2>
    <p>Attempting to initialize Firebase...</p>
    <div id="initStatus"></div>
    <div id="initDetails"></div>
  </div>

  <div class="test-section">
    <h2>Step 3: Authentication Test</h2>
    <p>Test Firebase Authentication with a temporary account:</p>
    <div style="margin: 15px 0;">
      <input type="email" id="testEmail" placeholder="test@example.com" value="test@example.com" />
      <input type="password" id="testPassword" placeholder="Password (min 6 chars)" value="test123456" />
      <div style="margin-top: 10px;">
        <button id="btnTestSignup">Test Sign Up</button>
        <button id="btnTestLogin">Test Login</button>
        <button id="btnTestLogout" disabled>Test Logout</button>
      </div>
    </div>
    <div id="authStatus"></div>
    <div id="authDetails"></div>
  </div>

  <div class="test-section">
    <h2>Step 4: Next Steps</h2>
    <div id="nextSteps"></div>
  </div>

  <!-- Load Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <script>
    // Configuration from index.html
    var FIREBASE_ENABLED = true;
    
    // This should match the configuration in index.html
    var firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY_HERE",
      authDomain: "your-project-id.firebaseapp.com",
      projectId: "your-project-id",
      storageBucket: "your-project-id.firebasestorage.app",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID_HERE",
      measurementId: "YOUR_MEASUREMENT_ID_HERE"
    };

    // Test results
    let firebaseApp = null;
    let firebaseAuth = null;
    let testResults = {
      configLoaded: false,
      firebaseInitialized: false,
      authWorking: false
    };

    // Helper functions
    function showStatus(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function showDetails(elementId, content) {
      const element = document.getElementById(elementId);
      element.innerHTML = content;
    }

    function isPlaceholderConfig() {
      if (!firebaseConfig || !firebaseConfig.apiKey || !firebaseConfig.projectId) {
        return true;
      }
      return firebaseConfig.apiKey.includes('YOUR_') || 
             firebaseConfig.apiKey.includes('PLACEHOLDER') ||
             firebaseConfig.projectId === 'your-project-id';
    }

    // Step 1: Check Configuration
    function checkConfiguration() {
      if (!firebaseConfig) {
        showStatus('configStatus', '‚ùå Error: firebaseConfig is not defined', 'error');
        showDetails('configDetails', '<p>Make sure to include the Firebase configuration in this file.</p>');
        return false;
      }

      const requiredKeys = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
      const missingKeys = requiredKeys.filter(key => !firebaseConfig[key]);

      if (missingKeys.length > 0) {
        showStatus('configStatus', `‚ùå Error: Missing configuration keys: ${missingKeys.join(', ')}`, 'error');
        return false;
      }

      if (isPlaceholderConfig()) {
        showStatus('configStatus', '‚ö†Ô∏è Warning: Using placeholder configuration', 'warning');
        showDetails('configDetails', `
          <p>The Firebase configuration contains placeholder values. You need to:</p>
          <ol>
            <li>Create a Firebase project at <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
            <li>Enable Email/Password authentication</li>
            <li>Copy your project's configuration</li>
            <li>Replace the placeholder values in <span class="code">index.html</span></li>
          </ol>
          <p>See <span class="code">FIREBASE_SETUP.md</span> for detailed instructions.</p>
        `);
        return false;
      }

      testResults.configLoaded = true;
      showStatus('configStatus', '‚úÖ Success: Configuration loaded correctly', 'success');
      showDetails('configDetails', `
        <pre>Project ID: ${firebaseConfig.projectId}
Auth Domain: ${firebaseConfig.authDomain}
Storage Bucket: ${firebaseConfig.storageBucket}</pre>
      `);
      return true;
    }

    // Step 2: Initialize Firebase
    function initializeFirebase() {
      if (!testResults.configLoaded) {
        showStatus('initStatus', '‚è≠Ô∏è Skipped: Configuration check failed', 'warning');
        return false;
      }

      try {
        // Check if Firebase is already initialized
        if (firebase.apps && firebase.apps.length > 0) {
          firebaseApp = firebase.apps[0];
          firebaseAuth = firebase.auth();
          testResults.firebaseInitialized = true;
          showStatus('initStatus', '‚úÖ Success: Firebase already initialized', 'success');
          showDetails('initDetails', `<p>Firebase SDK version: ${firebase.SDK_VERSION}</p>`);
          return true;
        }
        
        firebaseApp = firebase.initializeApp(firebaseConfig);
        firebaseAuth = firebase.auth();
        testResults.firebaseInitialized = true;
        showStatus('initStatus', '‚úÖ Success: Firebase initialized successfully', 'success');
        showDetails('initDetails', `<p>Firebase SDK version: ${firebase.SDK_VERSION}</p>`);
        return true;
      } catch (error) {
        showStatus('initStatus', `‚ùå Error: Failed to initialize Firebase`, 'error');
        showDetails('initDetails', `
          <pre>Error: ${error.message}

Common causes:
- Invalid API key
- Incorrect project ID
- Network connectivity issues
- Firebase quota exceeded
- Firebase already initialized (refresh the page)</pre>
        `);
        return false;
      }
    }

    // Step 3: Test Authentication
    document.getElementById('btnTestSignup').addEventListener('click', async function() {
      const email = document.getElementById('testEmail').value;
      const password = document.getElementById('testPassword').value;

      if (!testResults.firebaseInitialized) {
        showStatus('authStatus', '‚ö†Ô∏è Firebase is not initialized. Cannot test authentication.', 'warning');
        return;
      }

      if (!email || !password) {
        showStatus('authStatus', '‚ö†Ô∏è Please enter email and password', 'warning');
        return;
      }

      if (password.length < 6) {
        showStatus('authStatus', '‚ö†Ô∏è Password must be at least 6 characters', 'warning');
        return;
      }

      try {
        showStatus('authStatus', '‚è≥ Creating test account...', 'info');
        const userCredential = await firebaseAuth.createUserWithEmailAndPassword(email, password);
        testResults.authWorking = true;
        showStatus('authStatus', '‚úÖ Success: Test account created!', 'success');
        showDetails('authDetails', `
          <pre>User ID: ${userCredential.user.uid}
Email: ${userCredential.user.email}
Email Verified: ${userCredential.user.emailVerified}</pre>
          <p><strong>Important:</strong> Remember to delete this test account from Firebase Console ‚Üí Authentication ‚Üí Users</p>
        `);
        document.getElementById('btnTestLogout').disabled = false;
        updateNextSteps();
      } catch (error) {
        let errorMsg = error.message;
        let suggestions = '';

        switch (error.code) {
          case 'auth/email-already-in-use':
            errorMsg = 'This email is already registered. Try logging in instead.';
            break;
          case 'auth/invalid-email':
            errorMsg = 'Invalid email address format.';
            break;
          case 'auth/operation-not-allowed':
            errorMsg = 'Email/Password authentication is not enabled in Firebase Console.';
            suggestions = '<p><strong>Solution:</strong> Go to Firebase Console ‚Üí Authentication ‚Üí Sign-in method ‚Üí Enable Email/Password</p>';
            break;
          case 'auth/weak-password':
            errorMsg = 'Password is too weak. Use at least 6 characters.';
            break;
        }

        showStatus('authStatus', `‚ùå Error: ${errorMsg}`, 'error');
        if (suggestions) {
          showDetails('authDetails', suggestions);
        }
      }
    });

    document.getElementById('btnTestLogin').addEventListener('click', async function() {
      const email = document.getElementById('testEmail').value;
      const password = document.getElementById('testPassword').value;

      if (!testResults.firebaseInitialized) {
        showStatus('authStatus', '‚ö†Ô∏è Firebase is not initialized. Cannot test authentication.', 'warning');
        return;
      }

      try {
        showStatus('authStatus', '‚è≥ Logging in...', 'info');
        const userCredential = await firebaseAuth.signInWithEmailAndPassword(email, password);
        testResults.authWorking = true;
        showStatus('authStatus', '‚úÖ Success: Logged in!', 'success');
        showDetails('authDetails', `
          <pre>User ID: ${userCredential.user.uid}
Email: ${userCredential.user.email}</pre>
        `);
        document.getElementById('btnTestLogout').disabled = false;
        updateNextSteps();
      } catch (error) {
        let errorMsg = error.message;

        switch (error.code) {
          case 'auth/invalid-credential':
          case 'auth/wrong-password':
          case 'auth/user-not-found':
            errorMsg = 'Invalid email or password.';
            break;
          case 'auth/too-many-requests':
            errorMsg = 'Too many failed login attempts. Try again later.';
            break;
        }

        showStatus('authStatus', `‚ùå Error: ${errorMsg}`, 'error');
      }
    });

    document.getElementById('btnTestLogout').addEventListener('click', async function() {
      try {
        await firebaseAuth.signOut();
        showStatus('authStatus', '‚úÖ Success: Logged out', 'success');
        showDetails('authDetails', '');
        document.getElementById('btnTestLogout').disabled = true;
      } catch (error) {
        showStatus('authStatus', `‚ùå Error: ${error.message}`, 'error');
      }
    });

    // Step 4: Show Next Steps
    function updateNextSteps() {
      let html = '';

      if (!testResults.configLoaded) {
        html = `
          <div class="status warning">
            <strong>‚ö†Ô∏è Configuration Not Complete</strong>
          </div>
          <p>You need to complete the Firebase setup:</p>
          <ol>
            <li>Follow the instructions in <span class="code">FIREBASE_SETUP.md</span></li>
            <li>Create a Firebase project</li>
            <li>Update the configuration in <span class="code">index.html</span></li>
            <li>Refresh this page to test again</li>
          </ol>
        `;
      } else if (!testResults.firebaseInitialized) {
        html = `
          <div class="status error">
            <strong>‚ùå Firebase Initialization Failed</strong>
          </div>
          <p>Check the error message above and:</p>
          <ol>
            <li>Verify your API key is correct</li>
            <li>Check your network connection</li>
            <li>Review Firebase Console for any issues</li>
          </ol>
        `;
      } else if (!testResults.authWorking) {
        html = `
          <div class="status info">
            <strong>‚úÖ Firebase is Configured</strong>
          </div>
          <p>Firebase is initialized, but authentication hasn't been tested yet. Try the authentication test above.</p>
        `;
      } else {
        html = `
          <div class="status success">
            <strong>üéâ All Tests Passed!</strong>
          </div>
          <p>Firebase is fully configured and working. You can now:</p>
          <ol>
            <li>Use the main application at <span class="code">index.html</span></li>
            <li>Delete the test account from Firebase Console if desired</li>
            <li>Configure security rules for production</li>
            <li>Add your production domain to authorized domains</li>
          </ol>
          <p><strong>Remember:</strong> Delete this test file (<span class="code">test-firebase-config.html</span>) before deploying to production.</p>
        `;
      }

      showDetails('nextSteps', html);
    }

    // Run initial checks
    window.addEventListener('load', function() {
      checkConfiguration();
      initializeFirebase();
      updateNextSteps();
    });
  </script>
</body>
</html>
