<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Nigeria Multi-User Accounting & Tax ‚Äî Full Prototype</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --gap:12px; --muted:#666; --danger:#b00; --accent:#0b76d1; --bg:#f8f9fb; --panel:#fff; }
    html,body { height:100%; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:12px; color:#222; background:var(--bg); }
    header { display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    h1 { margin:0; font-size:1.05rem; }
    .panel { border:1px solid #e1e4e8; padding:12px; background:var(--panel); border-radius:8px; }
    .controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    label { font-size:0.9rem; color:var(--muted); }
    select,input[type="text"],input[type="number"],input[type="date"],textarea,input[type="password"] { padding:6px; border:1px solid #cfcfcf; border-radius:6px; }
    button { padding:8px 10px; border-radius:6px; border:1px solid #bbb; background:#fff; cursor:pointer; }
    button.primary { background:var(--accent); color:#fff; border-color:var(--accent); }
    button.small { padding:6px 8px; font-size:0.9rem; }
    .section { margin-top:14px; }
    .form-inline { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .ledger-table { border-collapse: collapse; width:100%; margin-top:10px; }
    .ledger-table th, .ledger-table td { border:1px solid #ddd; padding:8px; text-align:left; font-size:0.95rem; vertical-align: middle; }
    .ledger-table th { background:#f2f6fa; }
    .totals, .tax-summary, .inventory-panel, .assets-panel { background:#f7f9fc; padding:10px; margin-top:10px; border-radius:6px; border:1px solid #eef2f6; }
    .muted { color:var(--muted); font-size:0.9rem; }
    .actions { display:flex; gap:6px; }
    .danger { color:var(--danger); border-color:var(--danger); background: #fff5f5; }
    .modalOverlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.25); z-index:50; }
    .modal { display:none; position:fixed; left:50%; top:8%; transform:translateX(-50%); background:white; border:1px solid #cfcfcf; padding:16px; z-index:51; border-radius:8px; width:min(1100px,96vw); }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    .spacer { flex:1 1 auto; }
    small.note { color:var(--muted); display:block; margin-top:6px; }
    .grid { display:grid; gap:8px; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); }
    .flag { background:#eef6ff; padding:3px 6px; border-radius:4px; color:#05507a; font-size:0.85rem; }
    .account-category { font-size:0.85rem; color:var(--muted); padding:2px 6px; border-radius:4px; border:1px solid #eee; background:#fbfcfe; }
    .smallInput { width:110px; }
    .table-scroll { max-height:260px; overflow:auto; }
    .notice { background:#fff9e6; border:1px solid #ffe6a8; padding:8px; border-radius:6px; color:#6a4e00; }
    .mutedBlock { color:var(--muted); font-size:0.9rem; margin-top:6px; }
    .form-section { margin-top:10px; padding:8px; border-radius:6px; border:1px dashed #e6e6e6; background:#fcfcfd; }
    .inline-label { display:flex; gap:6px; align-items:center; }
    .account-row { display:flex; gap:6px; align-items:center; justify-content:space-between; padding:6px 0; border-bottom:1px solid #f0f0f0; }
    .small-muted { font-size:0.85rem; color:var(--muted); }
    .tabbar { display:flex; gap:6px; }
    .tab { padding:6px 10px; border-radius:6px; border:1px solid #e6e6e6; background:#fff; cursor:pointer; }
    .tab.active { background:var(--accent); color:#fff; border-color:var(--accent); }
    .receipt-thumb { max-width:64px; max-height:64px; display:inline-block; border:1px solid #eee; padding:2px; border-radius:4px; margin-right:6px; }
    .link-like { color:var(--accent); cursor:pointer; text-decoration:underline; }
    @media (max-width:760px){ .form-inline{flex-direction:column;align-items:stretch} header{flex-direction:column;align-items:flex-start} }
    .small-note { font-size:0.85rem; color:var(--muted); }
    .auth-bar { margin-left:auto; display:flex; gap:8px; align-items:center; }
    .muted-pill { background:#f2f4f7; padding:4px 8px; border-radius:6px; font-size:0.9rem; color:#333; }
    .disabled { opacity:0.45; pointer-events:none; }
    .code { font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; background:#f3f5f7; padding:4px 6px; border-radius:4px; }
    /* Pre-login overlay styles */
    .prelogin-overlay { position:fixed; inset:0; background:linear-gradient(135deg, #0b76d1 0%, #00a3b5 100%); z-index:9999; display:flex; align-items:center; justify-content:center; }
    .prelogin-overlay.hidden { display:none; }
    .prelogin-card { background:#fff; padding:40px 48px; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,0.3); text-align:center; max-width:420px; width:90%; }
    .prelogin-card h2 { margin:0 0 8px 0; font-size:1.5rem; color:#222; }
    .prelogin-tagline { color:#0b76d1; font-size:1rem; font-weight:600; margin:0 0 12px 0; }
    .prelogin-offer-box { background:linear-gradient(135deg, #0b76d1 0%, #00a3b5 100%); color:#fff; padding:12px 16px; border-radius:10px; margin:0 0 18px 0; }
    .prelogin-offer-box .timer-label { font-size:0.85rem; margin-bottom:4px; }
    .prelogin-offer-box .timer-value { font-size:1.5rem; font-weight:700; letter-spacing:1px; }
    .prelogin-offer-box .buy-now-btn { display:inline-block; margin-top:10px; padding:10px 28px; background:#fff; color:#0b76d1; font-weight:700; border-radius:8px; text-decoration:none; transition:ba[...]\n  </style>

  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- SheetJS for XLSX export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <!-- Pre-login overlay - blocks access until user signs in -->
  <div id="preLoginOverlay" class="prelogin-overlay">
    <div class="prelogin-card prelogin-card-wide">
      <h2>Nigeria Accounting & Tax Engine</h2>
      <p class="prelogin-tagline">Your all-in-one financial management solution!</p>

      <!-- Offer countdown timer -->
      <div id="preloginOfferBox" class="offer-countdown-box">
        <div class="countdown-label">üî• Limited Time Offer Ends In:</div>
        <div class="countdown-value" id="preloginCountdown">3d 00:00:00</div>
      </div>

      <!-- Pricing Plan Dropdown (collapsed from cards) -->
      <div style="margin:16px 0; text-align:left;">
        <label style="display:block; margin-bottom:8px; color:#fff; font-weight:700;">Choose a plan:</label>
        <select id="preloginPlanSelect" style="padding:10px 12px; border-radius:8px; border:1px solid #cfcfcf; width:100%; max-width:360px;">
          <option value="Enterprise">Enterprise ‚Äî Popular</option>
          <option value="Individual">Individual ‚Äî 7 Day Trial</option>
          <option value="Company">Company ‚Äî 7 Day Trial</option>
        </select>

        <!-- Collapsed plan details (shows features, addons, totals) -->
        <div id="planDetails" class="plan-card" style="margin-top:12px;">
          <h3 id="planName">Enterprise <span class="plan-badge" id="planBadge">Popular</span></h3>
          <div class="plan-pricing">
            <div class="plan-full-price" id="planFullPrice">‚Ç¶37,500/year</div>
            <div class="plan-offer-price" id="planOfferPrice">‚Ç¶25,000/year</div>
          </div>
          <ul class="plan-features" id="planFeatures">
            <!-- Populated dynamically -->
          </ul>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="applyOffer" checked />
            <label for="applyOffer">Apply Buy Now Offer</label>
          </div>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="planAddon" />
            <label for="planAddon">Add: Self Filing Support <span class="addon-price" id="planAddonPrice">ÔøΩÔøΩ30,000/year</span></label>
          </div>
          <div class="plan-total">
            <div class="plan-total-label">Total</div>
            <div class="plan-total-value" id="planTotal">‚Ç¶25,000</div>
          </div>
          <a href="https://paystack.shop/pay/enterprise25000?plan=enterprise&price=25000" target="_blank" class="plan-buy-btn" id="planBuyLink">Buy Now</a>
        </div>
      </div>

      <p class="prelogin-subtitle">Sign in or create an account to continue</p>

      <!-- Auth tabs (merged from auth.html) -->
      <div class="auth-tabs">
        <button id="authTabLogin" class="tab active">Login</button>
        <button id="authTabSignup" class="tab">Sign up</button>
      </div>

      <!-- Login panel -->
      <div id="authLoginPanel" class="auth-panel prelogin-form">
        <label>Username or Email:
          <input type="text" id="preLoginUsername" placeholder="Enter username or email" autocomplete="username" />
        </label>
        <label>Password:
          <input type="password" id="preLoginPassword" placeholder="Enter password" autocomplete="current-password" />
        </label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
          <button class="primary prelogin-btn" id="preLoginSubmit">Sign In</button>
          <a id="preloginForgotLink" class="link-like" style="margin-left:8px; color:#fff;">Forgot Password?</a>
        </div>
        <p id="authLoginMsg" class="auth-msg"></p>
      </div>

      <!-- Signup panel (merged from auth.html) -->
      <div id="authSignupPanel" class="auth-panel prelogin-form hidden">
        <label>Full Name:
          <input type="text" id="authSignupName" placeholder="Enter your full name" autocomplete="name" required />
        </label>
        <label>Username:
          <input type="text" id="authSignupUsername" placeholder="Choose a username" autocomplete="username" required />
        </label>
        <label>Email:
          <input type="email" id="authSignupEmail" placeholder="your@email.com" autocomplete="email" required />
        </label>
        <label>Password (min 6 chars):
          <input type="password" id="authSignupPassword" placeholder="Choose a password" autocomplete="new-password" minlength="6" required />
        </label>
        <label>Confirm Password:
          <input type="password" id="authSignupPassword2" placeholder="Confirm password" minlength="6" required />
        </label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="primary prelogin-btn" id="authSignupSubmit">Create Account</button>
          <button class="prelogin-btn" id="authSignupCancel" type="button">Cancel</button>
        </div>
        <p id="authSignupMsg" class="auth-msg"></p>
      </div>

      <!-- Enquiries contact block -->
      <div class="prelogin-enquiries">
        <div class="enquiries-title">Enquiries</div>
        <div class="enquiries-item">üìû Call: <a href="tel:+234">+234</a></div>
        <div class="enquiries-item">üí¨ Chat: <a href="tel:+234">+234</a></div>
        <div class="enquiries-item">‚úâÔ∏è Email: <a href="mailto:salesrepng@gmail.com">salesrepng@gmail.com</a></div>
        <div class="enquiries-item">üìç Address: &mdash;</div>
      </div>

      <p class="prelogin-note">Note: This is a prototype. Credentials stored locally. Passwords hashed with SHA-256.</p>
    </div>
  </div>

  <header>
    <h1>Nigeria Accounting & Tax Engine ‚Äî Prototype</h1>

    <div class="panel controls" style="align-items:center;">
      <label>Active User:</label>
      <select id="userSelect"></select>
      <button class="small" id="btnAddUser">+ User</button>
      <button class="small" id="btnEditUser">Edit</button>
      <button class="small danger" id="btnDeleteUser">Delete</button>

      <div style="width:1px;height:28px;background:#e6e6e6;margin:0 8px;"></div>

      <label>Business:</label>
      <select id="businessSelect"></select>
      <button class="small" id="btnAddBusiness">+ Business</button>
      <button class="small" id="btnEditBusiness">Edit</button>
      <button class="small danger" id="btnDeleteBusiness">Delete</button>
      <button class="small" id="btnManageAccounts">Manage Accounts</button>

      <div class="spacer"></div>

      <div class="tabbar">
        <button class="tab active" id="btnLedgerTab">Ledger</button>
        <button class="tab" id="btnReportsTab">Reports</button>
      </div>

      <div style="width:8px;"></div>

      <div class="auth-bar">
        <span id="authInfo" class="small-muted"></span>
        <button id="btnLogin" class="small primary">Login</button>
        <button id="btnLogout" class="small" style="display:none;">Logout</button>
        <button id="btnExport" class="small">Export JSON</button>
        <button id="btnImport" class="small">Import JSON</button>
        <button id="btnClearAll" class="small danger">Clear All</button>
        <input type="file" id="fileInput" accept="application/json" style="display:none;" />
        <a id="buyNowBtn" class="small primary" href="https://paystack.shop/pay/financialbook" target="_blank" style="text-decoration:none;">Buy Now</a>
        <span id="offerTimer" class="small-note" style="margin-left:8px;">Offer ends in: <strong id="offerCountdown">3d 00:00:00</strong></span>
      </div>
    </div>
  </header>

  <!-- Hero Promo Section (visible after pre-login overlay is dismissed) -->
  <section id="heroPromo" class="hero-promo">
    <h2>üéâ Limited Time Offer ‚Äî Get Started Today!</h2>
    <p>Manage your Nigerian tax, accounting, and finances seamlessly with our powerful all-in-one engine.</p>
    <div class="hero-timer">Offer ends in: <strong id="heroCountdown">3d 00:00:00</strong></div>
    <a href="https://paystack.shop/pay/financialbook" target="_blank" class="hero-cta">Buy Now</a>
  </section>

  <main>
    <section id="ledgerSection" class="panel section">
      <h2 style="margin:0 0 8px 0;">Add Transaction / Inventory / Asset</h2>

      <div id="mainTxnForm" class="form-inline">
        <label>Date: <input type="date" id="txnDate" /></label>

        <label>Action:
          <select id="txnAction">
            <option value="">-- Select action --</option>
            <option value="InventoryPurchase">Inventory Purchase</option>
            <option value="InventorySale">Inventory Sale</option>
            <option value="Expense">Expense</option>
            <option value="Income">Income</option>
            <option value="AssetPurchase">Asset Purchase</option>
            <option value="AssetDisposal">Asset Disposal</option>
            <option value="OpeningAssetBal">Opening Asset Bal</option>
          </select>
        </label>

        <label>Account:
          <select id="txnAccount"></select>
        </label>

        <label>Description: <input type="text" id="txnDesc" placeholder="Details" /></label>

        <label>Amount (‚Ç¶): <input type="number" id="txnAmount" min="0" step="0.01" /></label>

        <label id="txnVatLabel">VAT:
          <select id="txnVatType">
            <option value="none">None</option>
            <option value="exclusive">VAT (exclusive)</option>
            <option value="inclusive">VAT (inclusive)</option>
          </select>
        </label>

        <label class="inline-label">
          <input type="checkbox" id="txnWht" /> WHT applied
        </label>
        <label id="txnWhtBasisLabel" style="display:none;">Basis:
          <select id="txnWhtBasis">
            <option value="gross">Gross</option>
            <option value="net">Net</option>
          </select>
        </label>
        <label id="txnWhtRateLabel" style="display:none;">Rate (%) <input type="number" id="txnWhtRate" class="smallInput" min="0" step="0.01" /></label>

        <label class="inline-label" id="txnPayeLabel">
          <input type="checkbox" id="txnSalary" /> Salary (PAYE)
        </label>

        <div style="width:1px;height:28px;background:#e6e6e6;margin:0 8px;"></div>

        <label>Adjustment:
          <select id="txnAdjustmentType">
            <option value="">None</option>
            <option value="disallowable">Disallowable expense</option>
            <option value="nontaxable">Non-taxable income</option>
          </select>
        </label>
        <label id="txnAdjustmentAmountLabel" style="display:none;">Amt (‚Ç¶): <input type="number" id="txnAdjustmentAmount" class="smallInput" min="0" step="0.01" /></label>

        <label>Contact: <input type="text" id="txnContact" placeholder="Contact name" /></label>

        <label>Receipt: <input type="file" id="txnReceipt" /></label>

        <button class="primary" id="btnAddTxn">Add</button>
      </div>

      <div id="inventorySubform" style="margin-top:10px; display:none;" class="panel inventory-panel">
        <h3 style="margin:4px 0;">Inventory / Items</h3>
        <div class="form-inline">
          <label>Item:
            <select id="invItemSelect"></select>
          </label>
        </div>
      </div>
    </section>
  </main>
</body>
</html>