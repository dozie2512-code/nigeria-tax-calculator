   <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simplify Taxes with Taxmax ‚Äî Full Prototype</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <!-- External Stylesheet -->
  <link rel="stylesheet" href="styles.css" />
  
  <!-- Inline styles removed - moved to styles.css -->

  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- SheetJS for XLSX export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Firebase compat SDK for Authentication -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  
  <!-- Firebase Authentication Module -->
  <script src="firebase-auth.js"></script>
</head>
<body>
  <!-- Pre-login overlay - blocks access until user signs in -->
  <div id="preLoginOverlay" class="prelogin-overlay">
    <div class="prelogin-card prelogin-card-wide">
      <h2>Simplify Your Taxes with Taxmax</h2>
      <p class="prelogin-tagline">Accurate Taxes, Real Time Filing</p>

      <!-- Offer countdown timer -->
      <div id="preloginOfferBox" class="offer-countdown-box">
        <div class="countdown-label">üî• Limited Time Offer Ends In:</div>
        <div class="countdown-value" id="preloginCountdown">3d 00:00:00</div>
      </div>

      <!-- Pricing Plan Cards -->
      <div class="plan-cards">
        <!-- Business Plan (formerly Enterprise) -->
        <details class="plan-card highlight">
          <summary>
            <div class="plan-header-left">
              <h3>Business <span class="plan-badge">Popular</span></h3>
            </div>
            <div class="plan-header-right">
              <span class="plan-offer-price">‚Ç¶40,000/year</span>
              <span class="plan-arrow">‚ñº</span>
            </div>
          </summary>
          <div class="plan-pricing">
            <div class="plan-full-price">‚Ç¶60,000/year</div>
            <div class="plan-offer-price">‚Ç¶40,000/year</div>
          </div>
          <ul class="plan-features">
            <li>2 Users + Tax Advisor</li>
            <li>Record Income &amp; Expenses &amp; Profits</li>
            <li>Track VAT, WHT, PAYE and PIT</li>
            <li>Tax Support via Chat and Email</li>
          </ul>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="businessApplyOffer" checked />
            <label for="businessApplyOffer">Apply Buy Now Offer</label>
          </div>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="businessAddon" />
            <label for="businessAddon">Add: Self Filing Support <span class="addon-price">‚Ç¶50,000/year</span></label>
          </div>
          <div class="plan-total">
            <div class="plan-total-label">Total</div>
            <div class="plan-total-value" id="businessTotal">‚Ç¶40,000</div>
          </div>
          <div class="plan-buttons-container">
            <a href="https://buy.stripe.com/business-plan" target="_blank" rel="noopener noreferrer" class="plan-buy-btn" id="businessBuyLink">Buy Now</a>
          </div>
        </details>

        <!-- Company Plan -->
        <details class="plan-card highlight">
          <summary>
            <div class="plan-header-left">
              <h3>Company <span class="plan-badge">7 Day Trial</span></h3>
            </div>
            <div class="plan-header-right">
              <span class="plan-offer-price">‚Ç¶60,000/year</span>
              <span class="plan-arrow">‚ñº</span>
            </div>
          </summary>
          <div class="plan-pricing">
            <div class="plan-full-price">‚Ç¶80,000/year</div>
            <div class="plan-offer-price">‚Ç¶60,000/year</div>
          </div>
          <ul class="plan-features">
            <li>3 Users + Tax Advisor</li>
            <li>Record Income &amp; Expenses &amp; Profits</li>
            <li>Track VAT, WHT, PAYE, CGT, and CIT</li>
            <li>Tax Support via Chat and Email</li>
          </ul>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="companyApplyOffer" checked />
            <label for="companyApplyOffer">Apply Buy Now Offer</label>
          </div>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="companyAddon" />
            <label for="companyAddon">Add: Self Filing Support <span class="addon-price">‚Ç¶70,000/year</span></label>
          </div>
          <div class="plan-total">
            <div class="plan-total-label">Total</div>
            <div class="plan-total-value" id="companyTotal">‚Ç¶60,000</div>
          </div>
          <div class="plan-buttons-container">
            <a href="https://buy.stripe.com/company-plan" target="_blank" rel="noopener noreferrer" class="plan-buy-btn" id="companyBuyLink">Buy Now</a>
          </div>
        </details>

        <!-- New Enterprise Plan -->
        <details class="plan-card highlight">
          <summary>
            <div class="plan-header-left">
              <h3>Enterprise <span class="plan-badge">For Accountants</span></h3>
            </div>
            <div class="plan-header-right">
              <span class="plan-offer-price">‚Ç¶100,000/year</span>
              <span class="plan-arrow">‚ñº</span>
            </div>
          </summary>
          <div class="plan-pricing">
            <div class="plan-full-price">‚Ç¶150,000/year</div>
            <div class="plan-offer-price">‚Ç¶100,000/year</div>
          </div>
          <ul class="plan-features">
            <li>Designed for Accountants and Multi-Business</li>
            <li>Includes 3 Subscription Plans (Enterprise/Company)</li>
            <li>Track VAT, WHT, PAYE, CGT, PIT, and CIT</li>
            <li>Build and Support Multiple Clients</li>
            <li>Earn Monthly Revenues on Tax Hire</li>
            <li>Tax Support via Chat and Email</li>
          </ul>
          <div class="plan-checkbox-row">
            <input type="checkbox" id="enterpriseApplyOffer" checked />
            <label for="enterpriseApplyOffer">Apply Buy Now Offer</label>
          </div>
          <div class="plan-total">
            <div class="plan-total-label">Total</div>
            <div class="plan-total-value" id="enterpriseTotal">‚Ç¶100,000</div>
          </div>
          <div class="plan-buttons-container">
            <a href="https://buy.stripe.com/enterprise-plan" target="_blank" rel="noopener noreferrer" class="plan-buy-btn" id="enterpriseBuyLink">Buy Now</a>
          </div>
        </details>

        <!-- Hire Tax Accountant Feature -->
        <details class="plan-card">
          <summary>
            <div class="plan-header-left">
              <h3>Hire Tax Accountant</h3>
            </div>
            <div class="plan-header-right">
              <span class="plan-offer-price">From ‚Ç¶15,000/month</span>
              <span class="plan-arrow">‚ñº</span>
            </div>
          </summary>
          <div class="plan-pricing" style="margin-bottom:12px;">
            <p style="margin:0 0 8px 0;font-size:0.9rem;">Professional tax services by qualified accountants</p>
          </div>
          <ul class="plan-features">
            <li><strong>‚Ç¶15,000/Month:</strong> Monthend Adjustment and Tax Filing</li>
            <li><strong>‚Ç¶25,000/Month:</strong> Monthend Adjustment and Tax Filing</li>
          </ul>
          <div class="plan-buttons-container">
            <a href="https://buy.stripe.com/hire-tax-accountant" target="_blank" rel="noopener noreferrer" class="plan-buy-btn">Hire Now</a>
          </div>
        </details>
      </div>

      <p class="prelogin-subtitle">Sign in or create an account to continue</p>

      <!-- Auth tabs (merged from auth.html) -->
      <div class="auth-tabs" role="tablist" aria-label="Authentication options">
        <button id="authTabLogin" class="tab active" role="tab" aria-selected="true" aria-controls="authLoginPanel">Login</button>
        <button id="authTabSignup" class="tab" role="tab" aria-selected="false" aria-controls="authSignupPanel">Sign up</button>
      </div>

      <!-- Login panel -->
      <div id="authLoginPanel" class="auth-panel prelogin-form" role="tabpanel" aria-labelledby="authTabLogin">
        <label for="preLoginUsername">Email:
          <input type="email" id="preLoginUsername" placeholder="Enter your email address" autocomplete="email" aria-required="true" />
        </label>
        <label for="preLoginPassword">Password:
          <input type="password" id="preLoginPassword" placeholder="Enter password" autocomplete="current-password" aria-required="true" />
        </label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
          <button class="primary prelogin-btn" id="preLoginSubmit" aria-label="Sign in to your account">Sign In</button>
          <a href="#" id="authForgotPassword" class="link-like" style="font-size:0.9rem;" aria-label="Reset your password">Forgot Password?</a>
        </div>
        <p id="authLoginMsg" class="auth-msg" role="alert" aria-live="polite"></p>
      </div>

      <!-- Signup panel (merged from auth.html) -->
      <div id="authSignupPanel" class="auth-panel prelogin-form hidden" role="tabpanel" aria-labelledby="authTabSignup">
        <label for="authSignupName">Full Name:
          <input type="text" id="authSignupName" placeholder="Enter your full name" autocomplete="name" required aria-required="true" />
        </label>
        <label for="authSignupUsername">Username:
          <input type="text" id="authSignupUsername" placeholder="Choose a username" autocomplete="username" required aria-required="true" />
        </label>
        <label for="authSignupEmail">Email:
          <input type="email" id="authSignupEmail" placeholder="your@email.com" autocomplete="email" required aria-required="true" />
        </label>
        <label for="authSignupPassword">Password (min 6 chars):
          <input type="password" id="authSignupPassword" placeholder="Choose a password" autocomplete="new-password" minlength="6" required aria-required="true" />
        </label>
        <label for="authSignupPassword2">Confirm Password:
          <input type="password" id="authSignupPassword2" placeholder="Confirm password" minlength="6" required aria-required="true" />
        </label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="primary prelogin-btn" id="authSignupSubmit" aria-label="Create new account">Create Account</button>
          <button class="prelogin-btn" id="authSignupCancel" type="button" aria-label="Cancel signup">Cancel</button>
        </div>
        <p id="authSignupMsg" class="auth-msg" role="alert" aria-live="polite"></p>
      </div>

      <p class="prelogin-note" id="authModeNote">Secure authentication powered by Firebase. Your data is stored locally in your browser.</p>
    </div>
  </div>

  <header role="banner">
    <h1>Simplify Your Taxes with Taxmax ‚Äî Prototype</h1>

    <nav class="panel controls" style="align-items:center;" role="navigation" aria-label="Main controls">
      <label for="userSelect">Active User:</label>
      <select id="userSelect" aria-label="Select active user"></select>
      <button class="small" id="btnAddUser" aria-label="Add new user">+ User</button>
      <button class="small" id="btnEditUser" aria-label="Edit selected user">Edit</button>
      <button class="small danger" id="btnDeleteUser" aria-label="Delete selected user">Delete</button>

      <div style="width:1px;height:28px;background:#e6e6e6;margin:0 8px;" role="separator" aria-hidden="true"></div>

      <label for="businessSelect">Business:</label>
      <select id="businessSelect" aria-label="Select business"></select>
      <button class="small" id="btnAddBusiness" aria-label="Add new business">+ Business</button>
      <button class="small" id="btnEditBusiness" aria-label="Edit selected business">Edit</button>
      <button class="small danger" id="btnDeleteBusiness" aria-label="Delete selected business">Delete</button>
      <button class="small" id="btnManageAccounts" aria-label="Manage accounts">Manage Accounts</button>

      <div class="spacer"></div>

      <div class="tabbar" role="tablist" aria-label="Main navigation tabs">
        <button class="tab active" id="btnLedgerTab" role="tab" aria-selected="true" aria-controls="ledgerSection">Ledger</button>
        <button class="tab" id="btnReportsTab" role="tab" aria-selected="false" aria-controls="reportsSection">Reports</button>
      </div>

      <div style="width:8px;"></div>

      <div class="auth-bar">
        <span id="authInfo" class="small-muted" role="status" aria-live="polite"></span>
        <span id="superAdminIndicator" class="muted-pill" role="status" aria-live="polite" style="display:none;background:#ff6b6b;color:#fff;">Super Admin</span>
        <button id="btnLogin" class="small primary" aria-label="Login to account">Login</button>
        <button id="btnLogout" class="small" style="display:none;" aria-label="Logout from account">Logout</button>
        <button id="btnSuperAdmin" class="small" style="background:#ff6b6b;color:#fff;border-color:#ff6b6b;" aria-label="Access super admin mode">Super Admin</button>
        <button id="btnExport" class="small" aria-label="Export data as JSON">Export JSON</button>
        <button id="btnImport" class="small" aria-label="Import data from JSON">Import JSON</button>
        <button id="btnClearAll" class="small danger" aria-label="Clear all data">Clear All</button>
        <input type="file" id="fileInput" accept="application/json" style="display:none;" aria-label="Select JSON file to import" />
      </div>
    </nav>
  </header>

  <!-- Hero Promo Section removed - pricing shown only in pre-login overlay -->

  <main role="main">
    <section id="ledgerSection" class="panel section" role="tabpanel" aria-labelledby="btnLedgerTab">
      <h2 style="margin:0 0 8px 0;">Add Transaction / Inventory / Asset</h2>

      <div id="mainTxnForm" class="form-inline">
        <label>Date: <input type="date" id="txnDate" /></label>

        <label>Action:
          <select id="txnAction">
            <option value="">-- Select action --</option>
            <option value="InventoryPurchase">Inventory Purchase</option>
            <option value="InventorySale">Inventory Sale</option>
            <option value="Expense">Expense</option>
            <option value="Revenue">Revenue</option>
            <option value="AssetPurchase">Asset Purchase</option>
            <option value="AssetDisposal">Asset Disposal</option>
            <option value="OpeningAssetBal">Opening Asset Bal</option>
          </select>
        </label>

        <label>Account:
          <select id="txnAccount"></select>
        </label>

        <label>Description: <input type="text" id="txnDesc" placeholder="Details" /></label>

        <label>Amount (‚Ç¶): <input type="number" id="txnAmount" min="0" step="0.01" /></label>

        <label id="txnVatLabel">VAT:
          <select id="txnVatType">
            <option value="none">None</option>
            <option value="exclusive">VAT (exclusive)</option>
            <option value="inclusive">VAT (inclusive)</option>
          </select>
        </label>

        <label class="inline-label">
          <input type="checkbox" id="txnWht" /> WHT applied
        </label>
        <label id="txnWhtBasisLabel" style="display:none;">Basis:
          <select id="txnWhtBasis">
            <option value="gross">Gross</option>
            <option value="net">Net</option>
          </select>
        </label>
        <label id="txnWhtRateLabel" style="display:none;">Rate (%) <input type="number" id="txnWhtRate" class="smallInput" min="0" step="0.01" /></label>

        <label class="inline-label" id="txnPayeLabel">
          <input type="checkbox" id="txnSalary" /> Salary (PAYE)
        </label>

        <div style="width:1px;height:28px;background:#e6e6e6;margin:0 8px;"></div>

        <label>Adjustment:
          <select id="txnAdjustmentType">
            <option value="">None</option>
            <option value="disallowable">Disallowable expense</option>
            <option value="nontaxable">Non-taxable income</option>
          </select>
        </label>
        <label id="txnAdjustmentAmountLabel" style="display:none;">Amt (‚Ç¶): <input type="number" id="txnAdjustmentAmount" class="smallInput" min="0" step="0.01" /></label>

        <label>Contact: <input type="text" id="txnContact" placeholder="Contact name" /></label>

        <label>Receipt: <input type="file" id="txnReceipt" /></label>

        <button class="primary" id="btnAddTxn">Add</button>
      </div>

      <div id="inventorySubform" style="margin-top:10px; display:none;" class="panel inventory-panel">
        <h3 style="margin:4px 0;">Inventory / Items</h3>
        <div class="form-inline">
          <label>Item:
            <select id="invItemSelect"></select>
          </label>
          <label>New Item: <input type="text" id="invNewName" placeholder="If adding new" /></label>
          <label>Account:
            <select id="invAccountSelect"></select>
          </label>
          <label>Qty: <input type="number" id="invQty" min="0" step="1" /></label>
          <label>Unit Price (‚Ç¶): <input type="number" id="invUnitPrice" min="0" step="0.01" /></label>

          <label>Opening Qty: <input type="number" id="invOpeningQty" min="0" step="1" /></label>
          <label>Opening Avg Cost (‚Ç¶): <input type="number" id="invOpeningAvgCost" min="0" step="0.01" /></label>

          <label id="invVatLabel">VAT:
            <select id="invVatType">
              <option value="none">None</option>
              <option value="exclusive">VAT (exclusive)</option>
              <option value="inclusive">VAT (inclusive)</option>
            </select>
          </label>

          <label>Contact: <input type="text" id="invContact" placeholder="Contact name" /></label>

          <label>Receipt: <input type="file" id="invReceipt" /></label>

          <button id="btnAddInv" class="small primary">Apply Inventory Action</button>
          <button id="btnInvCancel" class="small">Cancel</button>
          <button id="btnInvUndo" class="small danger">Undo last inventory action</button>
        </div>
        <small class="note">Inventory uses weighted average for COGS. Purchases update average; sales consume using current average cost.</small>
      </div>

      <div id="assetPurchaseSubform" style="margin-top:10px; display:none;" class="panel assets-panel">
        <h3 style="margin:4px 0;">Asset Purchase</h3>
        <div class="form-inline">
          <label>Asset name: <input type="text" id="assetName" list="assetNameSuggestions" /></label>
          <datalist id="assetNameSuggestions">
            <!-- Populated dynamically based on category selection -->
          </datalist>
          <label>Category:
            <select id="assetCategory">
              <option value="Property Plant and Equipment">Property Plant and Equipment</option>
              <option value="Furniture & Fittings">Furniture & Fittings</option>
              <option value="Motor Vehicles">Motor Vehicles</option>
              <option value="Land & Building">Land & Building</option>
              <option value="Shares">Shares</option>
              <option value="Other Asset">Other Asset</option>
            </select>
          </label>
          <label>Qty: <input type="number" id="assetQty" min="1" step="1" class="smallInput" value="1" /></label>
          <label>Unit Price (‚Ç¶): <input type="number" id="assetUnitPrice" min="0" step="0.01" /></label>
          <label>Cost (‚Ç¶): <input type="number" id="assetCost" min="0" step="0.01" /></label>
          <label>Opening Cost (‚Ç¶): <input type="number" id="assetOpeningCost" min="0" step="0.01" /></label>
          <label>Opening Accumulated Depreciation (‚Ç¶): <input type="number" id="assetOpeningAccDep" min="0" step="0.01" /></label>
          <label>Purchase date: <input type="date" id="assetPurchaseDate" /></label>
          <label>Useful life (years): <input type="number" id="assetLife" min="1" step="1" class="smallInput" /></label>
          <label>Capital allowance % (annual): <input type="number" id="assetCA" min="0" step="0.01" class="smallInput" /></label>
        </div>
        <div class="form-inline" style="margin-top:8px;">
          <label>Purchase account:
            <select id="assetPurchaseAccount"></select>
          </label>

          <label>Classification:
            <select id="assetClassification">
              <option value="Fixed">Fixed</option>
              <option value="Chargeable">Chargeable</option>
            </select>
          </label>

          <label>Depreciation rate % (annual): <input type="number" id="assetDepRate" class="smallInput" min="0" step="0.01" /></label>

          <label>Contact: <input type="text" id="assetContact" placeholder="Contact name" /></label>

          <label>Receipt: <input type="file" id="assetReceipt" /></label>

          <button id="btnAddAsset" class="small primary">Record Asset Purchase</button>
          <button id="btnAssetCancel" class="small">Cancel</button>
          <button id="btnAssetUndo" class="small danger">Undo last asset action</button>
        </div>
        <small class="note">Depreciation = straight-line. Depreciation & capital allowance computed daily (prorated); asset schedule shows quantity and unit price.</small>
      </div>

      <div id="assetDisposalSubform" style="margin-top:10px; display:none;" class="panel assets-panel">
        <h3 style="margin:4px 0;">Asset Disposal</h3>
        <div class="form-inline">
          <label>Asset to dispose:
            <select id="assetDisposeSelect"></select>
          </label>
          <label>Disposal date: <input type="date" id="assetDisposalDate" /></label>
          <label>Quantity to dispose: <input type="number" id="assetDisposalQty" min="1" step="1" class="smallInput" value="1" /></label>
          <label>Disposal proceeds (‚Ç¶): <input type="number" id="assetDisposalProceeds" min="0" step="0.01" /></label>
          <label>Disposal account:
            <select id="assetDisposalAccount"></select>
          </label>
          <label>Contact: <input type="text" id="assetDisposalContact" placeholder="Contact name" /></label>
          <label>Receipt: <input type="file" id="assetDisposalReceipt" /></label>
          <button id="btnDisposeAsset" class="small danger">Record Disposal</button>
          <button id="btnAssetDisposalCancel" class="small">Cancel</button>
          <button id="btnAssetDisposalUndo" class="small danger">Undo last asset action</button>
        </div>
        <small class="note">Chargeable gains and losses will be classified based on asset classification and included in tax calculations according to entity rules. Profit/loss = proceeds - tax written down value (TWDV = ‚Ç¶10 residual at end of life).</small>
      </div>
    </section>

    <section id="ledgerListSection" class="panel section">

      <div class="search-bar form-inline">
        <input type="text" id="ledgerSearch" placeholder="Search by date/account/description/amount/contact" style="flex:1; padding:6px; border:1px solid #cfcfcf; border-radius:6px;" />
        <button class="small" id="btnSearch">Search</button>
        <button class="small" id="btnClearSearch">Clear</button>
      </div>

      <div class="table-scroll">
        <table class="ledger-table" id="ledgerTable">
          <thead>
            <tr>
              <th>Date</th><th>Action</th><th>Account</th><th>Description</th><th>Amount</th><th>VAT</th><th>WHT</th><th>PAYE</th><th>Contact</th><th>Receipt</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="plSnapshot" class="totals"></div>
      <div id="taxSummary" class="tax-summary"></div>
    </section>

    <section id="reportsSection" class="panel section" style="display:none;">
      <h2 style="margin:0 0 8px 0;">Report</h2>

      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px;">
        <button class="small tab active" data-report="vatReport">VAT Report</button>
        <button class="small tab" data-report="whtPayable">WHT Payable</button>
        <button class="small tab" data-report="whtReceivable">WHT Receivable</button>
        <button class="small tab" data-report="payeReport">PAYE Report</button>
        <button class="small tab" data-report="inventoryReport">Inventory Report</button>
        <button class="small tab" data-report="assetsReport">Assets Report</button>
        <button class="small tab" data-report="pitIndividual">PIT (Individual)</button>
        <button class="small tab" data-report="pitEnterprise">PIT (Enterprise)</button>
        <button class="small tab" data-report="cgtReport">CGT Report</button>
        <button class="small tab" data-report="companyAccounts">Company Accounts</button>
        <button class="small tab" data-report="auditTrail">Audit Trail</button>
        <button class="small tab" data-report="receiptsFolder">Receipts Folder</button>
      </div>

      <div style="display:flex; gap:8px; margin-bottom:8px;">
        <button id="btnExportCsv" class="small">Export CSV (selected)</button>
        <button id="btnExportPdf" class="small">Export PDF (selected)</button>
        <button id="btnExportXlsx" class="small">Export XLSX (selected)</button>
      </div>

      <div id="reportContent" style="min-height:160px;"></div>
    </section>

    <section class="panel section grid" id="quickPanels">
      <div>
        <h3>Profit & Loss Snapshot (Quick)</h3>
        <div id="plSnapshotQuick" class="panel" style="padding:8px;"></div>
      </div>
    </section>
  </main>

  <div id="modalOverlay" class="modalOverlay"></div>

  <!-- User modal -->
  <div id="userModal" class="modal">
    <h3 id="userModalTitle">Add User</h3>
    <div class="row">
      <label>Username: <input type="text" id="userName" /></label>
      <label>Display: <input type="text" id="userDisplay" /></label>
      <label>Password: <input type="password" id="userPassword" placeholder="Required for new users" /></label>
      <label>Role:
        <select id="userRole">
          <option value="User">User</option>
          <option value="Admin">Admin</option>
        </select>
      </label>
    </div>
    <div class="form-section">
      <h4 style="margin:4px 0;">Permissions (Admin can set per user)</h4>
      <div class="row">
        <label><input type="checkbox" id="permView" /> View</label>
        <label><input type="checkbox" id="permEdit" /> Edit</label>
        <label><input type="checkbox" id="permDelete" /> Delete</label>
      </div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button id="userCancel">Cancel</button>
      <button class="primary" id="userSave">Save</button>
    </div>
  </div>

  <!-- Business modal -->
  <div id="businessModal" class="modal">
    <h3 id="businessModalTitle">Add Business</h3>
    <div class="row">
      <label>Name: <input type="text" id="bizName" /></label>
      <label>Owner: <select id="bizOwner"></select></label>
    </div>
    <div class="row">
      <label>Entity type:
        <select id="bizEntity">
          <option value="Company">Company</option>
          <option value="Enterprise">Enterprise</option>
          <option value="Individual">Individual</option>
        </select>
      </label>
      <label>VAT rate %: <input type="number" id="bizVat" class="smallInput" min="0" step="0.01" /></label>
      <label>WHT rate %: <input type="number" id="bizWht" class="smallInput" min="0" step="0.01" /></label>
      <label id="bizTurnoverThresholdLabel">Turnover Threshold (CIT):
        <select id="bizTurnoverThresholdSelect" class="smallInput">
          <option value="50000000">‚Ç¶50,000,000</option>
          <option value="100000000">‚Ç¶100,000,000</option>
        </select>
      </label>
      <!-- CIT fields hidden but preserved in data via hidden inputs -->
      <input type="hidden" id="bizCit" />
      <input type="hidden" id="bizTurnoverThreshold" />
    </div>

    <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
      <label><input type="checkbox" id="bizVatEnabled" /> Enable VAT</label>
      <label><input type="checkbox" id="bizPitEnabled" /> Enable PIT (sole prop)</label>
      <label><input type="checkbox" id="bizPayeEnabled" /> Enable PAYE</label>
      <label style="margin-left:8px;"><input type="checkbox" id="bizShowLines" /> Show detailed tax summary</label>
      <!-- CIT enabled checkbox hidden but preserved -->
      <input type="hidden" id="bizCitEnabled" />
    </div>

    <div class="form-section">
      <div class="row">
        <label>Loss brought forward (‚Ç¶): <input type="number" id="bizLossBF" class="smallInput" min="0" step="0.01" /></label>
        <label>CA carryforward (‚Ç¶): <input type="number" id="bizCACF" class="smallInput" min="0" step="0.01" /></label>
      </div>

      <div class="row" style="margin-top:6px;">
        <label><input type="checkbox" id="bizDefaultExpenseDisallowable" /> Default expenses disallowable (business-level)</label>
        <label><input type="checkbox" id="bizDefaultRevenueNonTax" /> Default revenue non-taxable (business-level)</label>
      </div>

      <div style="margin-top:8px;">
        <h4 style="margin:6px 0 4px 0;">Annual statutory deductions (used for PAYE / PIT)</h4>
        <div class="row">
          <label>Pension (‚Ç¶): <input type="number" id="bizDedPension" class="smallInput" min="0" step="0.01" /></label>
          <label>Rent relief (‚Ç¶): <input type="number" id="bizDedRent" class="smallInput" min="0" step="0.01" /></label>
          <label>Life assurance (‚Ç¶): <input type="number" id="bizDedLife" class="smallInput" min="0" step="0.01" /></label>
          <label>Mortgage interest (‚Ç¶): <input type="number" id="bizDedMortgage" class="smallInput" min="0" step="0.01" /></label>
          <label>NHF (‚Ç¶): <input type="number" id="bizDedNHF" class="smallInput" min="0" step="0.01" /></label>
        </div>
        <small class="note">If you set statutory deductions on a contact (SoleTrader), that will override these values for PIT.</small>
      </div>

      <div style="margin-top:10px;">
        <h4 style="margin:6px 0 4px 0;">Contacts</h4>
        <div id="bizContactsList" style="max-height:160px; overflow:auto;"></div>
        <div class="row">
          <input type="text" id="newContactName" placeholder="Contact name" />
          <select id="newContactType">
            <option value="Customer">Customer</option>
            <option value="Vendor">Vendor</option>
            <option value="Employee">Employee</option>
            <option value="SoleTrader">SoleTrader</option>
          </select>
          <button id="btnAddContact" class="small">Add Contact</button>
        </div>
        <small class="note">Add a contact with type "SoleTrader" (or name "Sole trader") and set statutory deductions there if you want PIT to use per-sole-trader deductions.</small>
      </div>

    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
      <button id="bizCancel">Cancel</button>
      <button class="primary" id="bizSave">Save</button>
    </div>
  </div>

  <!-- Accounts modal -->
  <div id="accountsModal" class="modal">
    <h3>Manage Chart of Accounts</h3>
    <div id="accountsList" style="max-height:360px; overflow:auto;"></div>
    <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
      <input type="text" id="newAccountName" placeholder="Account name" style="flex:1;" />
      <select id="newAccountCategory" class="smallInput">
        <option value="Expense">Expense</option>
        <option value="Asset">Asset</option>
        <option value="Liability">Liability</option>
        <option value="Capital">Capital</option>
      </select>
      <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="newAccountDisallowable" /> Disallowable</label>
      <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="newAccountNonTax" /> Non-taxable</label>
      <select id="newAccountRentFreq">
        <option value="">Rent freq</option>
        <option value="monthly">Monthly rent</option>
        <option value="yearly">Yearly rent</option>
      </select>
      <button id="addAccountBtn" class="small">Add</button>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px;">
      <button id="closeAccountsBtn">Close</button>
    </div>
  </div>

  <!-- Contact Edit Modal - for editing contact statutory deductions -->
  <div id="contactEditModal" class="modal">
    <h3 id="contactEditModalTitle">Edit Contact</h3>
    <div class="row">
      <label>Name: <input type="text" id="contactEditName" /></label>
      <label>Type:
        <select id="contactEditType">
          <option value="Customer">Customer</option>
          <option value="Vendor">Vendor</option>
          <option value="Employee">Employee</option>
          <option value="SoleTrader">SoleTrader</option>
        </select>
      </label>
    </div>
    <div class="form-section" id="contactDeductionsSection">
      <h4 style="margin:6px 0 4px 0;">Statutory Deductions (for SoleTrader/Employee)</h4>
      <div class="row">
        <label>Pension (‚Ç¶): <input type="number" id="contactDedPension" class="smallInput" min="0" step="0.01" /></label>
        <label>Rent relief (‚Ç¶): <input type="number" id="contactDedRent" class="smallInput" min="0" step="0.01" /></label>
        <label>Life assurance (‚Ç¶): <input type="number" id="contactDedLife" class="smallInput" min="0" step="0.01" /></label>
      </div>
      <div class="row">
        <label>Mortgage interest (‚Ç¶): <input type="number" id="contactDedMortgage" class="smallInput" min="0" step="0.01" /></label>
        <label>NHF (‚Ç¶): <input type="number" id="contactDedNHF" class="smallInput" min="0" step="0.01" /></label>
      </div>
      <small class="note">These deductions override business-level statutory deductions when computing PIT/PAYE for this contact.</small>
    </div>
    <input type="hidden" id="contactEditId" />
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
      <button id="contactEditCancel">Cancel</button>
      <button class="primary" id="contactEditSave">Save</button>
    </div>
  </div>

  <!-- Login modal -->
  <div id="loginModal" class="modal">
    <h3>Login</h3>
    <div class="row">
      <label>Username: <input type="text" id="loginUsername" /></label>
      <label>Password: <input type="password" id="loginPassword" placeholder="(optional)" /></label>
    </div>
    <small class="note">Secure authentication powered by Firebase.</small>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
      <button id="loginCancel">Cancel</button>
      <button class="primary" id="loginSubmit">Login</button>
    </div>
  </div>

<div id="signupModal" class="modal">
  <h3>Signup ‚Äî Nigeria Tax (7-day trial)</h3>
  <div class="row">
    <label>Name: <input type="text" id="signupName" required></label>
    <label>Username: <input type="text" id="signupUsername" required></label>
    <label>Email: <input type="email" id="signupEmail" required placeholder="your@email.com"></label>
  </div>
  <div class="row">
    <label>Phone: <input type="tel" id="signupPhone" placeholder="e.g. +234..."></label>
    <label>Password: <input type="password" id="signupPassword" minlength="6" placeholder="Min 6 characters" required></label>
    <label>Plan:
      <select id="signupPlan">
        <option value="Individual">Individual</option>
        <option value="Enterprise">Enterprise</option>
        <option value="Company">Company</option>
      </select>
    </label>
  </div>
  <small class="note">Account valid for 7 days from signup. A notification will be sent to salesrepng@gmail.com.</small>
  <small class="note" style="display:block;margin-top:4px;color:#555;">Secure authentication powered by Firebase. Your credentials are safely managed by Firebase Authentication.</small>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
    <button id="signupCancel">Cancel</button>
    <button class="primary" id="signupSubmit">Create account</button>
  </div>
</div>

<div id="forgotModal" class="modal">
  <h3>Forgot Password</h3>
  <div class="row">
    <label>Email: <input type="email" id="forgotEmail" placeholder="Enter your email address"></label>
  </div>
  <div id="forgotModeNote">
    <small class="note" id="forgotNoteFirebase" style="display:none;">Enter your email address and we'll send you a password reset link.</small>
    <small class="note" id="forgotNoteLocal">We will open an email request to the admin/sales team to process the reset (prototype). If you are the user, contact your admin to reset.</small>
  </div>
  <p id="forgotMsg" class="auth-msg"></p>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
    <button id="forgotCancel">Cancel</button>
    <button class="primary" id="forgotSubmit">Send Reset Link</button>
  </div>
</div>

<!-- Entity Selection Modal - shown after signup -->
<div id="entitySelectModal" class="modal">
  <h3>Select Your Entity Type</h3>
  <p class="muted">Please confirm the type of entity you'll be using this account for:</p>
  <div class="row">
    <label>Entity Type:
      <select id="entitySelectType">
        <option value="Individual">Individual</option>
        <option value="Enterprise">Enterprise</option>
        <option value="Company">Company</option>
      </select>
    </label>
  </div>
  <small class="note">This will create a default business for your account with the selected entity type.</small>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
    <button class="primary" id="entitySelectConfirm">Confirm & Continue</button>
  </div>
</div>

<!-- Video Tour Modal - shown first time after signup -->
<div id="videoTourModal" class="modal" style="text-align:center;">
  <h3>Welcome to Simplify Your Taxes with Taxpro!</h3>
  <p class="muted">Take a quick 5-minute tour to learn how to use the app.</p>
  <div id="videoTourContainer" style="margin:16px 0;">
    <iframe id="tourVideoIframe" width="560" height="315" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>
  <div style="display:flex;gap:8px;justify-content:center;margin-top:10px;">
    <button id="videoTourSkip">Skip Tour</button>
    <button class="primary" id="videoTourWatch">Watch Tour</button>
  </div>
  <small class="note" style="margin-top:8px;display:block;">The tour will auto-close after 5 minutes if not dismissed.</small>
</div>

<!-- Super Admin Login Modal -->
<div id="superAdminModal" class="modal">
  <h3>Super Admin Access</h3>
  <p class="notice" style="margin-bottom:12px;">‚ö†Ô∏è Super admin access allows viewing and editing ALL data. Enter the super admin password to continue.</p>
  <div class="row">
    <label>Super Admin Password: <input type="password" id="superAdminPassword" placeholder="Enter super admin password" /></label>
  </div>
  <p id="superAdminMsg" class="auth-msg"></p>
  <small class="note" style="color:#b00;">üîí <strong>Security Note:</strong> This hardcoded password is for development/demo purposes only. In production, this feature should use environment variables or a secure authentication system.</small>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
    <button id="superAdminCancel">Cancel</button>
    <button class="primary" id="superAdminSubmit">Login as Super Admin</button>
  </div>
</div>

  <footer class="muted" style="margin-top:16px;">Simplify Your Taxes with Taxpro ‚Äî Accurate Taxes, Real time filing ‚Äî prototype stores data in localStorage (ntc_full_accounting_v1)</footer>


  <!-- Main Application JavaScript -->
  <script src="app.js"></script>
</body>
</html>
