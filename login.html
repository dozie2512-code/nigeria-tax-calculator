<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simplify Taxes with Taxmax â€” Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --gap:12px; --muted:#666; --danger:#b00; --accent:#0b76d1; --bg:#f8f9fb; --panel:#fff; }
    html,body { height:100%; margin:0; padding:0; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:#222; background:linear-gradient(135deg, #0b76d1 0%, #00a3b5 100%); display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .login-card { background:#fff; padding:40px 48px; border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.15); text-align:center; max-width:420px; width:90%; }
    .login-card h2 { margin:0 0 8px 0; font-size:1.5rem; color:#222; }
    .login-tagline { color:#0b76d1; font-size:1rem; font-weight:600; margin:0 0 24px 0; }
    .login-subtitle { color:var(--muted); margin:0 0 24px 0; font-size:0.95rem; }
    .login-form { display:flex; flex-direction:column; gap:16px; }
    .login-form label { display:flex; flex-direction:column; text-align:left; font-size:0.9rem; color:var(--muted); gap:6px; }
    .login-form input { padding:10px 12px; border:1px solid #cfcfcf; border-radius:8px; font-size:1rem; }
    .login-form input:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(11,118,209,0.15); }
    .login-btn { padding:12px 24px; font-size:1rem; margin-top:8px; border-radius:6px; border:1px solid var(--accent); background:var(--accent); color:#fff; cursor:pointer; }
    .login-btn:hover { background:#0a68be; }
    .login-note { color:var(--muted); font-size:0.8rem; margin:20px 0 0 0; }
    .auth-tabs { display:flex; gap:8px; margin-bottom:12px; justify-content:center; }
    .auth-tabs .tab { padding:8px 12px; border-radius:8px; border:1px solid #e6e9ef; background:#fff; cursor:pointer; }
    .auth-tabs .tab.active { background:var(--accent); color:#fff; border-color:var(--accent); }
    .auth-panel { display:block; }
    .auth-panel.hidden { display:none; }
    .auth-msg { color:var(--muted); margin-top:8px; font-size:0.9rem; }
    .link-like { color:var(--accent); cursor:pointer; text-decoration:underline; font-size:0.9rem; }
    .modal { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%, -50%); background:white; border:1px solid #cfcfcf; padding:16px; z-index:51; border-radius:8px; width:min(400px,90vw); box-shadow:0 4px 20px rgba(0,0,0,0.3); }
    .modal.active { display:block; }
    .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.25); z-index:50; }
    .modal-overlay.active { display:block; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    button { padding:8px 10px; border-radius:6px; border:1px solid #bbb; background:#fff; cursor:pointer; }
    button.primary { background:var(--accent); color:#fff; border-color:var(--accent); }
    .small-note { font-size:0.85rem; color:var(--muted); }
    .links-row { display:flex; gap:8px; justify-content:space-between; align-items:center; margin-top:8px; }
  </style>

  <!-- Firebase compat SDK for Authentication -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <script>
  /**
   * Firebase Configuration
   */
  var FIREBASE_ENABLED = true;

  var firebaseConfig = {
    apiKey: "AIzaSyDyLT58G18M7XPNLd3J6YnAMnLcKeEPmto",
    authDomain: "aaaa-b8178.firebaseapp.com",
    projectId: "aaaa-b8178",
    storageBucket: "aaaa-b8178.firebasestorage.app",
    messagingSenderId: "313899934004",
    appId: "1:313899934004:web:cb2b729fb3b42c57e00561",
    measurementId: "G-X18YDSXSZV"
  };
  
  var firebaseApp = null;
  var firebaseAuth = null;
  
  function isFirebaseConfigValid() {
    return typeof firebaseConfig !== 'undefined' && 
           firebaseConfig !== null &&
           typeof firebaseConfig.apiKey === 'string' &&
           typeof firebaseConfig.authDomain === 'string' &&
           typeof firebaseConfig.projectId === 'string';
  }
  
  if (FIREBASE_ENABLED && isFirebaseConfigValid()) {
    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      firebaseAuth = firebase.auth();
      console.log('Firebase Authentication initialized successfully');
    } catch (e) {
      console.error('Firebase initialization failed:', e.message);
      alert('Authentication system unavailable. Please check your internet connection or contact support.');
      FIREBASE_ENABLED = false;
    }
  } else if (FIREBASE_ENABLED) {
    console.error('Firebase configuration is invalid. Please verify your Firebase settings.');
    alert('Authentication configuration error. Please contact support.');
  }
  
  function isFirebaseAuthEnabled() {
    return FIREBASE_ENABLED && firebaseAuth !== null;
  }
  
  async function firebaseSignIn(email, password) {
    if (!isFirebaseAuthEnabled()) {
      return { success: false, error: 'Firebase not configured' };
    }
    
    try {
      var userCredential = await firebaseAuth.signInWithEmailAndPassword(email, password);
      var user = userCredential.user;
      return { 
        success: true, 
        user: {
          uid: user.uid,
          email: user.email,
          emailVerified: user.emailVerified
        }
      };
    } catch (error) {
      var errorMessage = 'Sign in failed';
      switch (error.code) {
        case 'auth/invalid-email':
          errorMessage = 'Invalid email address';
          break;
        case 'auth/user-disabled':
          errorMessage = 'This account has been disabled';
          break;
        case 'auth/user-not-found':
          errorMessage = 'No account found with this email';
          break;
        case 'auth/wrong-password':
          errorMessage = 'Invalid credentials';
          break;
        case 'auth/invalid-credential':
          errorMessage = 'Invalid email or password';
          break;
        case 'auth/too-many-requests':
          errorMessage = 'Too many failed attempts. Please try again later';
          break;
        default:
          errorMessage = error.message || 'Sign in failed';
      }
      return { success: false, error: errorMessage };
    }
  }
  
  async function firebaseSignUp(email, password) {
    if (!isFirebaseAuthEnabled()) {
      return { success: false, error: 'Firebase not configured' };
    }
    
    try {
      var userCredential = await firebaseAuth.createUserWithEmailAndPassword(email, password);
      var user = userCredential.user;
      return { 
        success: true, 
        user: {
          uid: user.uid,
          email: user.email,
          emailVerified: user.emailVerified
        }
      };
    } catch (error) {
      var errorMessage = 'Sign up failed';
      switch (error.code) {
        case 'auth/email-already-in-use':
          errorMessage = 'Email already registered';
          break;
        case 'auth/invalid-email':
          errorMessage = 'Invalid email address';
          break;
        case 'auth/weak-password':
          errorMessage = 'Password is too weak (min 6 characters)';
          break;
        case 'auth/operation-not-allowed':
          errorMessage = 'Email/password sign up is not enabled';
          break;
        default:
          errorMessage = error.message || 'Sign up failed';
      }
      return { success: false, error: errorMessage };
    }
  }
  
  async function firebaseSendPasswordReset(email) {
    if (!isFirebaseAuthEnabled()) {
      return { success: false, error: 'Firebase not configured' };
    }
    
    try {
      await firebaseAuth.sendPasswordResetEmail(email);
      return { success: true };
    } catch (error) {
      var errorMessage = 'Password reset failed';
      switch (error.code) {
        case 'auth/invalid-email':
          errorMessage = 'Invalid email address';
          break;
        case 'auth/user-not-found':
          errorMessage = 'No account found with this email';
          break;
        case 'auth/too-many-requests':
          errorMessage = 'Too many requests. Please try again later';
          break;
        default:
          errorMessage = error.message || 'Password reset failed';
      }
      return { success: false, error: errorMessage };
    }
  }
  </script>
</head>
<body>
  <div class="login-card">
    <h2>Simplify Your Taxes with Taxmax</h2>
    <p class="login-tagline">Accurate Taxes, Real Time Filing</p>
    <p class="login-subtitle">Sign in or create an account to continue</p>

    <!-- Auth tabs -->
    <div class="auth-tabs">
      <button id="authTabLogin" class="tab active">Login</button>
      <button id="authTabSignup" class="tab">Sign up</button>
    </div>

    <!-- Login panel -->
    <div id="authLoginPanel" class="auth-panel login-form">
      <label>Email:
        <input type="email" id="loginEmail" placeholder="Enter your email address" autocomplete="email" />
      </label>
      <label>Password:
        <input type="password" id="loginPassword" placeholder="Enter password" autocomplete="current-password" />
      </label>
      <div class="links-row">
        <a href="#" id="authForgotPassword" class="link-like">Forgot Password?</a>
        <a href="pricing.html" class="link-like">View Pricing</a>
      </div>
      <button class="primary login-btn" id="loginSubmit">Sign In</button>
      <p id="authLoginMsg" class="auth-msg"></p>
    </div>

    <!-- Signup panel -->
    <div id="authSignupPanel" class="auth-panel login-form hidden">
      <label>Full Name:
        <input type="text" id="authSignupName" placeholder="Enter your full name" autocomplete="name" required />
      </label>
      <label>Username:
        <input type="text" id="authSignupUsername" placeholder="Choose a username" autocomplete="username" required />
      </label>
      <label>Email:
        <input type="email" id="authSignupEmail" placeholder="your@email.com" autocomplete="email" required />
      </label>
      <label>Password (min 6 chars):
        <input type="password" id="authSignupPassword" placeholder="Choose a password" autocomplete="new-password" minlength="6" required />
      </label>
      <label>Confirm Password:
        <input type="password" id="authSignupPassword2" placeholder="Confirm password" minlength="6" required />
      </label>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="primary login-btn" id="authSignupSubmit">Create Account</button>
        <button class="login-btn" id="authSignupCancel" type="button">Cancel</button>
      </div>
      <p id="authSignupMsg" class="auth-msg"></p>
    </div>

    <p class="login-note" id="authModeNote">Secure authentication powered by Firebase. Your data is stored locally in your browser.</p>
  </div>

  <!-- Modal overlay -->
  <div id="modalOverlay" class="modal-overlay"></div>

  <!-- Forgot Password Modal -->
  <div id="forgotModal" class="modal">
    <h3>Forgot Password</h3>
    <div class="row">
      <label style="width:100%;">Email: 
        <input type="email" id="forgotEmail" placeholder="Enter your email address" style="width:100%;" />
      </label>
    </div>
    <div id="forgotModeNote">
      <small class="small-note" id="forgotNoteFirebase" style="display:block;">Enter your email address and we'll send you a password reset link.</small>
      <small class="small-note" id="forgotNoteLocal" style="display:none;">We will open an email request to the admin/sales team to process the reset (prototype). If you are the user, contact your admin to reset.</small>
    </div>
    <p id="forgotMsg" class="auth-msg"></p>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
      <button id="forgotCancel">Cancel</button>
      <button class="primary" id="forgotSubmit">Send Reset Link</button>
    </div>
  </div>

  <script>
  // Modal utilities
  function openModal(modal) {
    if (!modal) return;
    var overlay = document.getElementById('modalOverlay');
    modal.classList.add('active');
    if (overlay) overlay.classList.add('active');
  }

  function closeModal(modal) {
    if (!modal) return;
    var overlay = document.getElementById('modalOverlay');
    modal.classList.remove('active');
    if (overlay) overlay.classList.remove('active');
  }

  // Tab switching
  document.addEventListener('DOMContentLoaded', function() {
    var authTabLogin = document.getElementById('authTabLogin');
    var authTabSignup = document.getElementById('authTabSignup');
    var authLoginPanel = document.getElementById('authLoginPanel');
    var authSignupPanel = document.getElementById('authSignupPanel');

    if (authTabLogin) {
      authTabLogin.addEventListener('click', function() {
        authTabLogin.classList.add('active');
        authTabSignup.classList.remove('active');
        authLoginPanel.classList.remove('hidden');
        authSignupPanel.classList.add('hidden');
      });
    }

    if (authTabSignup) {
      authTabSignup.addEventListener('click', function() {
        authTabSignup.classList.add('active');
        authTabLogin.classList.remove('active');
        authSignupPanel.classList.remove('hidden');
        authLoginPanel.classList.add('hidden');
      });
    }

    // Cancel signup
    var authSignupCancel = document.getElementById('authSignupCancel');
    if (authSignupCancel) {
      authSignupCancel.addEventListener('click', function() {
        authTabLogin.click();
      });
    }

    // Login submit
    var loginSubmit = document.getElementById('loginSubmit');
    var loginEmail = document.getElementById('loginEmail');
    var loginPassword = document.getElementById('loginPassword');
    var authLoginMsg = document.getElementById('authLoginMsg');

    if (loginSubmit) {
      loginSubmit.addEventListener('click', async function() {
        var email = loginEmail.value.trim().toLowerCase();
        var password = loginPassword.value;

        if (!email || !password) {
          authLoginMsg.textContent = 'Please enter both email and password.';
          authLoginMsg.style.color = '#b00';
          return;
        }

        authLoginMsg.textContent = 'Signing in...';
        authLoginMsg.style.color = 'var(--muted)';

        var result = await firebaseSignIn(email, password);

        if (result.success) {
          authLoginMsg.textContent = 'Success! Redirecting...';
          authLoginMsg.style.color = 'green';
          // Redirect to main app
          setTimeout(function() {
            window.location.href = 'index.html';
          }, 1000);
        } else {
          authLoginMsg.textContent = result.error || 'Login failed';
          authLoginMsg.style.color = '#b00';
        }
      });
    }

    // Signup submit
    var authSignupSubmit = document.getElementById('authSignupSubmit');
    var authSignupName = document.getElementById('authSignupName');
    var authSignupUsername = document.getElementById('authSignupUsername');
    var authSignupEmail = document.getElementById('authSignupEmail');
    var authSignupPassword = document.getElementById('authSignupPassword');
    var authSignupPassword2 = document.getElementById('authSignupPassword2');
    var authSignupMsg = document.getElementById('authSignupMsg');

    if (authSignupSubmit) {
      authSignupSubmit.addEventListener('click', async function() {
        var name = authSignupName.value.trim();
        var username = authSignupUsername.value.trim();
        var email = authSignupEmail.value.trim().toLowerCase();
        var password = authSignupPassword.value;
        var password2 = authSignupPassword2.value;

        if (!name || !username || !email || !password) {
          authSignupMsg.textContent = 'Please fill in all required fields.';
          authSignupMsg.style.color = '#b00';
          return;
        }

        if (password !== password2) {
          authSignupMsg.textContent = 'Passwords do not match.';
          authSignupMsg.style.color = '#b00';
          return;
        }

        if (password.length < 6) {
          authSignupMsg.textContent = 'Password must be at least 6 characters.';
          authSignupMsg.style.color = '#b00';
          return;
        }

        authSignupMsg.textContent = 'Creating account...';
        authSignupMsg.style.color = 'var(--muted)';

        var result = await firebaseSignUp(email, password);

        if (result.success) {
          authSignupMsg.textContent = 'Account created! Redirecting...';
          authSignupMsg.style.color = 'green';
          // Redirect to main app
          setTimeout(function() {
            window.location.href = 'index.html';
          }, 1000);
        } else {
          authSignupMsg.textContent = result.error || 'Signup failed';
          authSignupMsg.style.color = '#b00';
        }
      });
    }

    // Forgot password link
    var authForgotPassword = document.getElementById('authForgotPassword');
    var forgotModal = document.getElementById('forgotModal');
    var forgotCancel = document.getElementById('forgotCancel');
    var forgotSubmit = document.getElementById('forgotSubmit');
    var forgotEmail = document.getElementById('forgotEmail');
    var forgotMsg = document.getElementById('forgotMsg');
    var forgotNoteFirebase = document.getElementById('forgotNoteFirebase');
    var forgotNoteLocal = document.getElementById('forgotNoteLocal');

    if (authForgotPassword) {
      authForgotPassword.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Update modal UI based on Firebase availability
        if (isFirebaseAuthEnabled()) {
          if (forgotNoteFirebase) forgotNoteFirebase.style.display = 'block';
          if (forgotNoteLocal) forgotNoteLocal.style.display = 'none';
        } else {
          if (forgotNoteFirebase) forgotNoteFirebase.style.display = 'none';
          if (forgotNoteLocal) forgotNoteLocal.style.display = 'block';
        }
        
        openModal(forgotModal);
      });
    }

    if (forgotCancel) {
      forgotCancel.addEventListener('click', function() {
        if (forgotEmail) forgotEmail.value = '';
        if (forgotMsg) forgotMsg.textContent = '';
        closeModal(forgotModal);
      });
    }

    if (forgotSubmit) {
      forgotSubmit.addEventListener('click', async function() {
        var email = forgotEmail.value.trim().toLowerCase();

        if (!email) {
          forgotMsg.textContent = 'Please enter your email address.';
          forgotMsg.style.color = '#b00';
          return;
        }

        // Validate email format
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          forgotMsg.textContent = 'Please enter a valid email address.';
          forgotMsg.style.color = '#b00';
          return;
        }

        if (isFirebaseAuthEnabled()) {
          forgotMsg.textContent = 'Sending reset link...';
          forgotMsg.style.color = 'var(--muted)';

          var result = await firebaseSendPasswordReset(email);

          if (result.success) {
            forgotMsg.textContent = 'Password reset email sent! Check your inbox.';
            forgotMsg.style.color = 'green';

            setTimeout(function() {
              if (forgotEmail) forgotEmail.value = '';
              if (forgotMsg) forgotMsg.textContent = '';
              closeModal(forgotModal);
            }, 2500);
          } else {
            forgotMsg.textContent = result.error || 'Failed to send reset email.';
            forgotMsg.style.color = '#b00';
          }
        } else {
          forgotMsg.textContent = 'Password reset unavailable: Firebase not configured.';
          forgotMsg.style.color = '#b00';
        }
      });
    }

    // Close modal when clicking overlay
    var modalOverlay = document.getElementById('modalOverlay');
    if (modalOverlay) {
      modalOverlay.addEventListener('click', function() {
        var modals = document.querySelectorAll('.modal.active');
        modals.forEach(function(modal) {
          closeModal(modal);
        });
      });
    }
  });
  </script>
</body>
</html>
